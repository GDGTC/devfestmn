<link rel="import" href="../../../bower_components/polymer/polymer.html">

<polymer-element name="gdg-notification-scroll-animate" attributes="uid message animation timeout">
  <template>
    <link rel="stylesheet" href="gdg-notification-scroll-animate.css">

    <gdg-animation-globals values="{{animGlobals}}"></gdg-animation-globals>

    <div id="{{ 'contentContainer' + uid }}" class="revealOnScroll main-container">
      <p class="content"><span>{{message}}</span></p>
    </div>

  </template>
  <script>
    (function (Polymer, undefined) {

      var BASE_DURATION,
        windowHeight = Math.max(
          document.body.scrollHeight, document.documentElement.scrollHeight,
          document.body.offsetHeight, document.documentElement.offsetHeight,
          document.body.clientHeight, document.documentElement.clientHeight
        ),


        aparition = function (elem) {

        },

        slideInRight = function (elem) {

        },


        slideInRightAndHighlight = function (elem, contentContainer) {

          var timeline = new TimelineMax(),
            contentP = contentContainer.querySelector('.content');

          timeline.delay(BASE_DURATION * 1.5);

          timeline.from(
            contentContainer,
            BASE_DURATION * 0.4,
            {
              transform: 'translate3d(500px, 0, 0)',
              opacity: 0
            }
          );

          timeline.to(
            contentP,
            BASE_DURATION * 0.75,
            {
              backgroundColor: '#C172FF',
              ease: Back.easeOut.config(1.2)
            },
            '-=' + BASE_DURATION * 0.4
          );

          timeline.to(
            contentP,
            BASE_DURATION,
            {
              backgroundColor: 'transparent'
            }
          );
        },


      ///// TODO: Place animations in their own file
        animate = function (elem, contentContainer, animation) {

          BASE_DURATION = elem.animGlobals.BASE_DURATION;

          if (animation === 'slideInRightAndHighlight') {
            slideInRightAndHighlight(elem, contentContainer);
          } else if (animation === 'slideInRight') {
            slideInRight(elem, contentContainer);
          } else if (animation === 'aparition') {
            aparition(elem, contentContainer);
          }
        };


      var windowHeightPadded = windowHeight * 1.1,
          Modernizr = this.Modernizr,
          isTouch = Modernizr.touch;

      if (isTouch) {
        //console.log('Touch device detected!');
      }

      /**
       * Bind to scrolling events on an element's scroll container after the app's template is bound and the
       * custom element can find it
       */
      function bindScroll(scrollContainer, elem, animation) {
        scrollContainer.addEventListener('scroll', function (event) {
          revealOnScroll(event, elem, animation);
        });
      }


      /**
       * Is the element's container within the current window?
       */
      function isElemVisible(contentOffsetTop) {
        return contentOffsetTop > 0 && contentOffsetTop < windowHeightPadded;
      }


      /**
       * Adds and removes proper animation classing to the element
       * when it's within the view of the page
       */
      function revealOnScroll(event, elem, animation) {

        var contentContainer = elem.$['contentContainer' + elem.uid];
        var contentOffsetTop = contentContainer.getBoundingClientRect().top;


        // Add or remove appropriate animation classes
        if (isElemVisible(contentOffsetTop)) {
          // check if already animated so we only perform the animation once when the element enters view
          if (contentContainer.getAttribute('class').indexOf('animated') === -1) {
            animate(elem, contentContainer, animation);
            contentContainer.className += ' animated';
          }
        } else {
          contentContainer.className = contentContainer.className.replace(new RegExp('animated ' + animation), '');
        }
      }


      Polymer('gdg-notification-scroll-animate', {

        ready: function () {
          this.uid = this.uid || '';
          this.animation = this.animation || '';
        },

        domReady: function () {
          if (this.animation) {
            var scrollContainer = document.querySelector('#mainPanel');
            bindScroll(scrollContainer, this, this.animation);
          }

        }

      });

    }(Polymer));
  </script>
</polymer-element>

