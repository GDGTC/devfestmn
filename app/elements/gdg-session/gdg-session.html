<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/core-animated-pages/core-animated-pages.html">
<link rel="import" href="../../../bower_components/core-signals/core-signals.html">

<link rel="import" href="../gdg-presentation-card/gdg-presentation-card.html">
<link rel="import" href="../gdg-presentation-details/gdg-presentation-details.html">
<link rel="import" href="../../../bower_components/firebase-element/firebase-element.html">

<polymer-element name="gdg-session" attributes="sessionId viewMode">

  <template>
    <link rel="stylesheet" href="gdg-session.css">

    <core-signals on-core-signal-view-mode="{{handleNewViewMode}}"></core-signals>

    <firebase-element location="https://devfestmn.firebaseio.com/presentations/{{sessionId}}"
                      keys="{{keys}}"
                      data="{{presentations}}"
                      id="fbPresentations">

    </firebase-element>

    <section class="session-banner-container">
      <h1>I'm the banner area for each session. Make me prettier!</h1>
    </section>

    <!--
    <core-animated-pages flex
                         id="sessionItems"
                         selected="0"
                         on-core-animated-pages-transition-end="{{transitionEnd}}"
                         transitions="hero-transition cross-fade">
    -->


    <template repeat="{{presentation in samplePresentations}}">


      <!-- Test cards (pre-Firebase!) -->
      <gdg-presentation-card favorited="{{presentation.favorited}}"
                             on-favorite-tapped="{{handleFavorited}}"
                             style="{{'background-color: ' +  presentation.primaryHexColor + ';'}}"
                             class="{{ {featured: presentation.featured} | tokenList }}"
                             hidden?="{{viewMode === 'favorites' && !presentation.favorited}}">

        <img src="{{presentation.iconUrl}}" width="70" height="70">

        <div>

          <p>Speakers: <span>
                          {{presentation.speakers['1'] }}
                          <span hidden?="{{!presentation.speakers['2'] }}">
                            and {{presentation.speakers['2']}}
                          </span>
                       </span>
          </p>

          <div class="description" hidden?="{{!presentation.featured}}">
            <p>
              This is the description for this event, which is only visible here when the
              item gets set to "featured" and is moved up and given full width.
            </p>
          </div>

        </div>

        <h2 style="{{'background-color: ' + presentation.accentHexColor + ';'}}">
          <span>{{presentation.subject}}</span>
        </h2>

      </gdg-presentation-card>
    </template>


    <!--
    </core-animated-pages>
    -->

    <!-- TODO: Use Repeated template below with Firebase data

    <template repeat="key in keys">
      <gdg-presentation-card id="key"
                             favorite="{{presentations[key].favorite}}"
                             on-favorite-tap="{{handleFavorited}}"
                             hidden?="{{viewMode == 'favorites' && !presentations[key].favorite}}">

        <img src="{{presentations[key].avatar}}" width="70" height="70">

        <h2>{{sessions[key].name}}</h2>

        <p>{{sessions[key].shortDescription}}</p>

        <p>Speaker: {{sessionData[key].speaker}}</p>

        <p>Room: {{sessions[key].location}}</p>

        <gdg-presentation-details presentationId="key" hidden?="{{selected != key}}">
        </gdg-presentation-details>
      </gdg-presentation-card>

    </template>
    -->


  </template>
  <script>
    (function () {
      Polymer({

        handleFavorited: function (event, detail, sender) {

          //  sender.templateInstance.model is a reference to the model data used to
          // construct a template instance. In this case, it would be
          // the 'presentation' object used to create a <gdg-presentation-card>
          var presentation = sender.templateInstance.model.presentation;
          console.log(presentation);
          //this.$.fbPresentations[presentation].favorited = true;  // TODO: Something like this to update the Firebase model

          // TODO: update the firebase model. Right now, this is a test by updating the samples

        },

        expandDetails: function (e) {
          var presentation = e.target.templateInstance.model.presentation;
          this.$.sessionItems.selected = presentation;
          console.log(presentation);
          console.log(this.$.sessionItems);

        },


        collapseDetails: function () {
          this.lastSelected = this.$.sessionItems.selected;
          console.log(this.lastSelected);
          this.$.sessionItems.selected = 0;
        },

        transitionEnd: function () {
          if (this.lastSelected) {
            this.lastSelected = null;
          }
        },

        handleNewViewMode: function (e, detail, sender) {
          console.log("New View Mode!");
          console.log(detail);
          this.viewMode = detail;
        },

        samplePresentations: [
          {
            "id": 1,
            "speakers": {
              "1": "Aaron Goldberg"
            },
            "subject": "RecyclerView",
            "track": "android",
            "primaryHexColor": "#78C15B",
            "accentHexColor": "#C6FF00",
            "featured": false
          },
          {
            "id": 2,
            "speakers": {
              "1": "Brian Yencho",
              "2": "Sean Weisner"
            },
            "subject": "Apps for Android Wear",
            "track": "wearables",
            "primaryHexColor": "#B388FF",
            "accentHexColor": "#7E57C2",
            "featured": false
          },
          {
            "id": 3,
            "speakers": {
              "1": "Ilya Verbitsky"
            },
            "subject": "WebRTC Workshop (Video Chat)",
            "track": "chromeCloud",
            "primaryHexColor": "#84FFFF",
            "accentHexColor": "#03A9F4",
            "featured": false
          },
          {
            "id": 4,
            "speakers": {
              "1": "Noah Blon"
            },
            "subject": "Material Design",
            "track": "frontEnd",
            "primaryHexColor": "#FF8A80",
            "accentHexColor": "#FF5252",
            "featured": false
          },
          {
            "id": "5",
            "speakers": {
              "1": "Steven Fluin"
            },
            "subject": "AngularJS Workshop",
            "track": "gettingStarted",
            "primaryHexColor": "#FFFF8D",
            "accentHexColor": "#FFEB3B",
            "featured": true
          }
        ]


      });
    })();
  </script>
</polymer-element>
