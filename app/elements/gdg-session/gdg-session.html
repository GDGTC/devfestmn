<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../gdg-presentation-card/gdg-presentation-card.html">
<link rel="import" href="../gdg-presentation-details/gdg-presentation-details.html">

<polymer-element name="gdg-session" attributes="sessionId viewMode">

  <template>
    <link rel="stylesheet" href="gdg-session.css">

    <firebase-element location="https://devfestmn.firebaseio.com/presentations/{{sessionId}}"
                      keys="{{keys}}"
                      data="{{presentations}}"
                      id="fbPresentations">

    </firebase-element>

    <template repeat="{{presentation in samplePresentations}}">


      <!-- Test cards (pre-Firebase!) -->
      <gdg-presentation-card favorited="{{presentation.favorited}}"
                             on-favorite-tapped="{{handleFavorited}}"
                             style="{{'background-color: ' +  presentation.primaryHexColor + ';'}}"
                             hidden?="{{viewMode == 'favorites' && !presentation.favorited}}">

        <img src="{{presentation.iconUrl}}" width="70" height="70">

        <p>Speakers: <span>
                        {{presentation.speakers['1'] }}
                        <span hidden?="{{!presentation.speakers['2'] }}">
                          and {{presentation.speakers['2']}}
                        </span>
                     </span>
        </p>

        <h2 style="{{'background-color: ' + presentation.accentHexColor + ';'}}">{{presentation.subject}}</h2>



        <gdg-presentation-details presentationId="key" hidden?="{{selected != key}}">
        </gdg-presentation-details>

      </gdg-presentation-card>


    </template>


    <!-- TODO: Use Repeated template below with Firebase data

    <template repeat="key in keys">
      <gdg-presentation-card id="key"
                             favorite="{{presentations[key].favorite}}"
                             on-favorite-tap="{{handleFavorited}}"
                             hidden?="{{viewMode == 'favorites' && !presentations[key].favorite}}">

        <img src="{{presentations[key].avatar}}" width="70" height="70">

        <h2>{{sessions[key].name}}</h2>

        <p>{{sessions[key].shortDescription}}</p>

        <p>Speaker: {{sessionData[key].speaker}}</p>

        <p>Room: {{sessions[key].location}}</p>

        <gdg-presentation-details presentationId="key" hidden?="{{selected != key}}">
        </gdg-presentation-details>
      </gdg-presentation-card>

    </template>
    -->


  </template>
  <script>
    (function () {
      Polymer({

        handleFavorited: function (event, detail, sender) {
          console.log("Hello!");

          //  sender.templateInstance.model is a reference to the model data used to
          // construct a template instance. In this case, it would be
          // the 'presentation' object used to create a <gdg-presentation-card>
          var presentation = sender.templateInstance.model.presentation;
          console.log(presentation);
          this.$.fbPresentations[presentation].favorited = true;  // TODO: Something like this to update the Firebase model
        },



        samplePresentations: [
          {
            "speakers": {
              "1": "Aaron Goldberg"
            },
            "subject": "RecyclerView",
            "track": "android",
            "primaryHexColor":  "#78C15B",
            "accentHexColor": "#C6FF00"
          },
          {
            "speakers": {
              "1": "Brian Yencho",
              "2": "Sean Weisner"
            },
            "subject": "Apps for Android Wear",
            "track": "wearables",
            "primaryHexColor":  "#B388FF",
            "accentHexColor": "#7E57C2"
          },
          {
            "speakers": {
              "1": "Ilya Verbitsky"
            },
            "subject": "WebRTC Workshop (Video Chat)",
            "track": "chromeCloud",
            "primaryHexColor": "#84FFFF",
            "accentHexColor": "#03A9F4"

          },
          {
            "speakers": {
              "1": "Noah Blon"
            },
            "subject": "Material Design",
            "track": "frontEnd",
            "primaryHexColor": "#FF8A80",
            "accentHexColor": "#FF5252"
          },
          {
            "speakers": {
              "1": "Steven Fluin"
            },
            "subject": "AngularJS Workshop",
            "track": "gettingStarted",
            "primaryHexColor": "#FFFF8D",
            "accentHexColor": "#FFEB3B"
          }
        ]


      });
    })();
  </script>
</polymer-element>
